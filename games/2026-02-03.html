<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>FlipStitch — Today’s Daily Word</title>
<style>
  :root{
    --bg:#f7f7fb;
    --panel:#ffffff;
    --ink:#1f2330;
    --muted:#6b7280;
    --accent:#4f46e5;
    --accent-2:#22c55e;
    --warn:#ef4444;
    --tile:#eef2ff;
    --tile-border:#c7d2fe;
    --good:#16a34a;
    --bad:#ef4444;
    --shadow:0 6px 20px rgba(31,35,48,0.12);
    --radius:14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    color:var(--ink);
    background:linear-gradient(180deg,#f6f7ff 0%, #f2f5ff 40%, #eef4ff 100%);
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .wrap{
    width: min(860px, 100%);
    padding: clamp(14px, 2.5vmin, 24px);
  }
  .card{
    background:var(--panel);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding: clamp(14px, 3.2vmin, 28px);
    display:flex;
    flex-direction:column;
    gap: clamp(12px, 2.6vmin, 22px);
  }
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:14px;
    flex-wrap:wrap;
  }
  .title{
    display:flex;
    align-items:baseline;
    gap:.6rem;
    flex-wrap:wrap;
  }
  h1{
    font-size: clamp(20px, 4.2vmin, 32px);
    line-height:1.1;
    margin:0;
    letter-spacing:.2px;
  }
  .date-tag{
    font-size: clamp(12px, 1.9vmin, 14px);
    color:var(--muted);
    background:#f1f5f9;
    border-radius:999px;
    padding:.35rem .7rem;
    white-space:nowrap;
  }
  .rulebox{
    background:#f8fafc;
    border:1px solid #e5e7eb;
    border-radius:12px;
    padding:12px 14px;
    font-size: clamp(13px, 2vmin, 14px);
    line-height:1.35;
  }
  .rulebox b{color:#0f172a}
  .hintline{
    display:flex;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
    gap:10px;
  }
  .hint{
    color:#334155;
    font-size: clamp(13px, 2vmin, 15px);
  }
  .pill{
    display:inline-flex;align-items:center;gap:.5rem;
    padding:.35rem .65rem;border-radius:999px;background:#eef2ff;color:#4338ca;
    font-weight:600;font-size:12px;border:1px solid #e0e7ff;
  }
  .out{
    background:#0f172a;
    color:#e5e7eb;
    border-radius:12px;
    padding:10px 12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    flex-wrap:wrap;
  }
  .out-word{
    font-variant-ligatures:none;
    letter-spacing:.08em;
    font-weight:700;
    font-size: clamp(18px, 4.5vmin, 28px);
    line-height:1;
    word-break:break-all;
  }
  .match{
    font-size: clamp(12px, 1.8vmin, 14px);
    color:#94a3b8;
  }
  .tiles{
    display:flex;
    gap: clamp(10px, 1.8vmin, 14px);
    flex-wrap:wrap;
    justify-content:center;
  }
  .tile{
    position:relative;
    user-select:none;
    background:var(--tile);
    border:2px solid var(--tile-border);
    color:#1e1b4b;
    padding:14px 16px;
    border-radius:12px;
    min-width:88px;
    min-height:62px;
    display:flex;align-items:center;justify-content:center;
    font-weight:800;
    font-size: clamp(18px, 4.5vmin, 26px);
    letter-spacing:.06em;
    flex:1 1 120px;
    cursor:pointer;
    transition:.15s transform ease,.15s border-color ease,.15s background ease,.15s box-shadow ease;
  }
  .tile:after{
    content:"";
    position:absolute;inset:auto 8px -6px 8px;
    height:4px;border-radius:4px;background:linear-gradient(90deg, #dbeafe 0, #c7d2fe 50%, #dbeafe 100%);
    opacity:.9;
  }
  .tile.sel{
    border-color:var(--accent);
    box-shadow:0 0 0 4px rgba(79,70,229,.12) inset;
    transform:translateY(-2px);
  }
  .tile.locked{
    background:#dcfce7;border-color:#86efac;color:#065f46;
  }
  .controls{
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    gap:10px;
  }
  button{
    -webkit-tap-highlight-color: transparent;
    appearance:none;border:0;background:#e2e8f0;color:#0f172a;border-radius:12px;
    padding:12px 14px;font-weight:700;cursor:pointer;transition:.15s transform ease,.15s background ease;
    min-height:48px;
  }
  button:active{transform:translateY(1px)}
  .primary{background:var(--accent);color:white}
  .success{background:var(--accent-2);color:white}
  .danger{background:#fee2e2;color:#991b1b}
  .ghost{background:#f1f5f9;color:#0f172a}
  .wide{grid-column: span 2}
  .status{
    text-align:center;
    font-size: clamp(12px, 1.9vmin, 14px);
    color:var(--muted);
    min-height:1.2em;
  }
  .toast{
    text-align:center;
    font-size: clamp(13px, 2.2vmin, 16px);
    font-weight:700;
    color:#065f46;
    background:#dcfce7;border:1px solid #86efac;border-radius:12px;
    padding:10px 12px;
    display:none;
  }
  .toast.show{display:block}
  .footerline{
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
    color:var(--muted);font-size:12px;margin-top:4px;
  }
  .dot{width:6px;height:6px;border-radius:50%;background:#a5b4fc;display:inline-block;margin:0 6px;vertical-align:middle}
  .small{font-size:12px;color:#64748b}
  .kudos{
    display:none;
    text-align:center;
    font-weight:800;
    color:#0f172a;
    background:linear-gradient(90deg, #dcfce7, #e0f2fe);
    border:1px solid #bae6fd;
    border-radius:14px;
    padding:16px;
    font-size: clamp(16px, 3.6vmin, 22px);
  }
  .kudos.show{display:block}
  @media (max-height:720px){
    .rulebox{display:none}
  }
  @media (max-width:560px){
    .controls{grid-template-columns: repeat(2, 1fr)}
    .wide{grid-column: span 2}
    .tile{flex:1 1 42%}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="card" role="application" aria-label="FlipStitch daily word puzzle">
    <header>
      <div class="title">
        <h1>FlipStitch</h1>
        <span class="date-tag" id="dateTag">Loading…</span>
      </div>
      <span class="pill" id="dailyNo">Daily #—</span>
    </header>

    <div class="rulebox" aria-live="polite">
      Rules:
      <ul style="margin:.4rem 0 .2rem 1rem;padding:0">
        <li>Rearrange and flip the tiles to stitch together the hidden word.</li>
        <li>Tiles are real consecutive chunks of the word; use each exactly once.</li>
        <li>Tap a tile to select it, then use Flip / Move Left / Move Right.</li>
        <li>Press Check when you think it’s right. Goal: make the exact target word.</li>
      </ul>
    </div>

    <div class="hintline">
      <div class="hint" id="hintText">Hint: —</div>
      <div class="small">First letter hint: <b id="firstLetter">?</b></div>
    </div>

    <div class="out">
      <div class="out-word" id="outWord">————</div>
      <div class="match" id="matchInfo">0 letters in place</div>
    </div>

    <div class="tiles" id="tiles" aria-label="Reorderable tiles area"></div>

    <div class="controls">
      <button class="ghost" id="leftBtn" aria-label="Move selected tile left">◀ Move Left</button>
      <button class="ghost" id="rightBtn" aria-label="Move selected tile right">Move Right ▶</button>
      <button class="ghost" id="flipBtn" aria-label="Flip selected tile orientation">⤾ Flip</button>
      <button class="ghost" id="shuffleBtn" aria-label="Reset tiles to today’s starting scramble">↺ Reset</button>

      <button class="primary wide" id="checkBtn" aria-label="Check current arrangement">Check</button>
      <button class="success wide" id="shareBtn" aria-label="Copy result">Share</button>
    </div>

    <div class="status" id="statusLine" aria-live="polite"></div>
    <div class="toast" id="toast"></div>
    <div class="kudos" id="winBanner">Solved! See you tomorrow.</div>

    <div class="footerline">
      <div>
        Tiles: <span id="tileCount">—</span>
        <span class="dot"></span>
        Moves: <span id="moveCount">0</span>
      </div>
      <div>Deterministic daily puzzle • No timer</div>
    </div>
  </div>
</div>

<script>
(function(){
  // Curated daily list (8 or 9 letters only)
  const puzzles = [
    {word:"daybreak", hint:"first light of day"},
    {word:"rosewood", hint:"fragrant, reddish timber"},
    {word:"backfire", hint:"have the opposite effect"},
    {word:"moonrise", hint:"the moon coming up"},
    {word:"goldmine", hint:"source of great value"},
    {word:"downpour", hint:"heavy rain"},
    {word:"soapdish", hint:"tray by the sink"},
    {word:"underdog", hint:"expected loser"},
    {word:"shoelace", hint:"string for shoes"},
    {word:"lakeside", hint:"the shore of a lake"},
    {word:"shipyard", hint:"place where ships are built"},
    {word:"fireside", hint:"by the hearth"},
    {word:"wildfire", hint:"fast-spreading blaze"},
    {word:"landfall", hint:"first sight of land"},
    {word:"footnote", hint:"reference at page bottom"},
    {word:"overhaul", hint:"thorough repair"},
    {word:"drumroll", hint:"percussive flourish"},
    {word:"bookworm", hint:"avid reader"},
    {word:"lockpick", hint:"tool for opening locks"},
    {word:"snowshoe", hint:"winter walking aid"},
    {word:"bluebird", hint:"cheerful songbird"},
    {word:"keyboard", hint:"typing device"},
    {word:"chestnut", hint:"glossy brown nut"},
    {word:"backspin", hint:"reverse ball rotation"},
    {word:"eggshell", hint:"brittle outer layer"},
    {word:"overlord", hint:"supreme ruler"},
    {word:"softwood", hint:"timber from conifers"},
    {word:"hardback", hint:"book with rigid cover"},
    {word:"tiebreak", hint:"point to settle a tie"},
    {word:"outsmart", hint:"defeat by cleverness"},
    {word:"longshot", hint:"unlikely success"},
    {word:"homespun", hint:"plain and simple"},
    {word:"careworn", hint:"tired by worry"},
    {word:"sandstorm", hint:"blinding desert wind"},
    {word:"fireplace", hint:"built-in place for fire"},
    {word:"timescale", hint:"period of time considered"},
    {word:"watershed", hint:"drainage area; turning point"},
    {word:"crosswind", hint:"wind blowing sideways"},
    {word:"paintwork", hint:"the painted surface of something"},
    {word:"nightfall", hint:"onset of evening"},
    {word:"quicksand", hint:"deceptive sinking ground"},
    {word:"afterglow", hint:"lingering light or feeling"},
    {word:"landslide", hint:"earth collapse; easy win"},
    {word:"handshake", hint:"greeting with the hands"},
    {word:"steampunk", hint:"retro-futuristic style"},
    {word:"heartbeat", hint:"pulsing of the heart"},
    {word:"watermark", hint:"faint identifying paper mark"},
    {word:"undertone", hint:"subdued or underlying quality"},
    {word:"moonlight", hint:"light from the moon"},
    {word:"raincheck", hint:"promise to postpone"},
    {word:"starfruit", hint:"another name for carambola"},
    {word:"gearshift", hint:"lever for changing gears"},
    {word:"stalemate", hint:"no legal chess move"},
    {word:"shoemaker", hint:"person who makes shoes"},
    {word:"cornfield", hint:"field of maize"},
    {word:"blackbird", hint:"common black thrush"},
    {word:"lifesaver", hint:"rescuer; helpful candy"},
    {word:"arrowhead", hint:"point of an arrow"},
    {word:"toothache", hint:"aching tooth"},
    {word:"typewrite", hint:"use a typewriter"},
    {word:"newsstand", hint:"kiosk selling papers"},
    {word:"honeycomb", hint:"wax structure of bees"},
    {word:"horseshoe", hint:"U-shaped iron for a hoof"},
    {word:"goldsmith", hint:"one who works with gold"}
  ];

  // Utility: deterministic PRNG (Mulberry32)
  function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296}}

  // Utility: seeded shuffle
  function shuffle(arr, rand){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(rand()*(i+1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  // Date + identifiers
  const today = new Date();
  const y = today.getFullYear();
  const m = today.getMonth()+1;
  const d = today.getDate();
  const seedBase = y*10000 + m*100 + d;
  const rand = mulberry32(seedBase ^ 0x9e3779b9);
  const index = seedBase % puzzles.length;
  const dailyCount = Math.floor((Date.UTC(today.getFullYear(),today.getMonth(),today.getDate()) - Date.UTC(2024,0,1))/86400000) + 1;

  const target = puzzles[index].word.toLowerCase();
  const hint = puzzles[index].hint;

  // Segmenting rule: 9 -> 3x3, 8 -> 4x2
  function makeSegments(word){
    let segs=[];
    if(word.length===9){
      for(let i=0;i<9;i+=3){segs.push(word.slice(i,i+3))}
    }else if(word.length===8){
      for(let i=0;i<8;i+=2){segs.push(word.slice(i,i+2))}
    }else{
      // Fallback to roughly equal 3 parts
      const k=3, base=Math.floor(word.length/k), rem=word.length%k;
      let pos=0;
      for(let i=0;i<k;i++){
        const len = base + (i<rem?1:0);
        segs.push(word.slice(pos,pos+len));
        pos+=len;
      }
    }
    return segs;
  }

  // Initial tiles: order scrambled, some flipped
  const originalSegments = makeSegments(target).map((t,i)=>({id:i, text:t, flipped:false}));
  let tiles = originalSegments.map(x=>({...x}));

  // Apply deterministic shuffle and flips
  shuffle(tiles, rand);
  tiles = tiles.map(t=>{
    const flip = rand() < 0.5;
    return {...t, flipped: flip};
  });

  // Ensure not accidentally solved on load
  function currentStringFrom(list){
    return list.map(t => t.flipped ? reverse(t.text) : t.text).join("");
  }
  function reverse(s){return s.split("").reverse().join("")}
  if(currentStringFrom(tiles)===target){
    // swap first two to break solved state
    if(tiles.length>1){[tiles[0],tiles[1]]=[tiles[1],tiles[0]];}
    // still solved? flip first
    if(currentStringFrom(tiles)===target){tiles[0].flipped=!tiles[0].flipped;}
  }

  // State
  let selected = null;
  let moves = 0;
  let startingTiles = tiles.map(t=>({...t})); // for reset

  // Elements
  const dateTag = document.getElementById('dateTag');
  const dailyNo = document.getElementById('dailyNo');
  const hintText = document.getElementById('hintText');
  const firstLetterEl = document.getElementById('firstLetter');
  const outWord = document.getElementById('outWord');
  const matchInfo = document.getElementById('matchInfo');
  const tilesEl = document.getElementById('tiles');
  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');
  const flipBtn = document.getElementById('flipBtn');
  const shuffleBtn = document.getElementById('shuffleBtn');
  const checkBtn = document.getElementById('checkBtn');
  const shareBtn = document.getElementById('shareBtn');
  const statusLine = document.getElementById('statusLine');
  const toast = document.getElementById('toast');
  const winBanner = document.getElementById('winBanner');
  const tileCount = document.getElementById('tileCount');
  const moveCount = document.getElementById('moveCount');

  // Initialize UI
  dateTag.textContent = today.toLocaleDateString(undefined, { weekday:'short', month:'short', day:'numeric', year:'numeric' });
  dailyNo.textContent = "Daily #"+dailyCount;
  hintText.textContent = "Hint: "+hint;
  firstLetterEl.textContent = target[0].toUpperCase();
  tileCount.textContent = tiles.length;

  function renderTiles(){
    tilesEl.innerHTML = "";
    tiles.forEach((t, idx)=>{
      const el = document.createElement('button');
      el.type = "button";
      el.className = "tile" + (selected===idx?" sel":"");
      el.setAttribute('aria-pressed', selected===idx ? 'true' : 'false');
      // Visual lock if this tile is currently in correct absolute spot with right orientation
      const oriented = t.flipped ? reverse(t.text) : t.text;
      const from = tiles.slice(0, idx).map(x=>x.flipped?reverse(x.text):x.text).join("").length;
      const to = from + oriented.length;
      const slice = target.slice(from, to);
      const locked = oriented === slice;
      if(locked){ el.classList.add('locked'); el.title="This tile is correctly placed"; }
      el.textContent = oriented.toUpperCase();
      el.addEventListener('click', ()=>{
        if(isSolved()){ return; }
        selected = (selected===idx) ? null : idx;
        renderTiles();
        updateOut();
      });
      tilesEl.appendChild(el);
    });
  }

  function countMatches(a,b){
    let c=0; for(let i=0;i<a.length;i++){ if(a[i]===b[i]) c++; } return c;
  }

  function updateOut(){
    const str = currentStringFrom(tiles);
    outWord.textContent = str.toUpperCase();
    const m = countMatches(str, target);
    matchInfo.textContent = m + " letters in place";
    moveCount.textContent = String(moves);
    // Disable controls if no selection
    const dis = (selected===null) || isSolved();
    leftBtn.disabled = dis;
    rightBtn.disabled = dis;
    flipBtn.disabled = dis;
    checkBtn.disabled = isSolved();
    shuffleBtn.disabled = isSolved();
    shareBtn.disabled = false;
  }

  function isSolved(){
    return currentStringFrom(tiles) === target;
  }

  function moveSelected(dir){
    if(selected===null) return;
    const i = selected;
    const j = i + (dir==='left'?-1:1);
    if(j<0 || j>=tiles.length) return;
    [tiles[i], tiles[j]] = [tiles[j], tiles[i]];
    selected = j;
    moves++;
    renderTiles(); updateOut();
  }

  function flipSelected(){
    if(selected===null) return;
    tiles[selected].flipped = !tiles[selected].flipped;
    moves++;
    renderTiles(); updateOut();
  }

  function resetToStart(){
    tiles = startingTiles.map(t=>({...t}));
    selected = null;
    moves = 0;
    statusLine.textContent = "";
    toast.classList.remove('show');
    winBanner.classList.remove('show');
    renderTiles(); updateOut();
  }

  function showToast(msg, kind="good"){
    toast.textContent = msg;
    toast.style.borderColor = kind==="bad" ? "#fecaca" : "#86efac";
    toast.style.background = kind==="bad" ? "#fee2e2" : "#dcfce7";
    toast.style.color = kind==="bad" ? "#991b1b" : "#065f46";
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 2200);
  }

  // Button hooks
  leftBtn.addEventListener('click', ()=>moveSelected('left'));
  rightBtn.addEventListener('click', ()=>moveSelected('right'));
  flipBtn.addEventListener('click', ()=>flipSelected());
  shuffleBtn.addEventListener('click', ()=>resetToStart());
  checkBtn.addEventListener('click', ()=>{
    if(isSolved()){
      showToast("Already solved!", "good");
      return;
    }
    const str = currentStringFrom(tiles);
    if(str===target){
      finalizeWin();
    }else{
      const m = countMatches(str, target);
      statusLine.textContent = "Not quite. "+m+" of "+target.length+" letters are in the right spots.";
      showToast("Keep stitching…", "bad");
    }
  });

  function finalizeWin(){
    renderTiles();
    updateOut();
    statusLine.textContent = "You stitched the word!";
    winBanner.classList.add('show');
    showToast("Perfect! "+target.toUpperCase()+" in "+moves+" moves.");
    // Disable interaction
    selected = null;
    leftBtn.disabled = true;
    rightBtn.disabled = true;
    flipBtn.disabled = true;
    checkBtn.disabled = true;
    shuffleBtn.disabled = true;
  }

  // Share
  shareBtn.addEventListener('click', ()=>{
    const solved = isSolved();
    const formed = currentStringFrom(tiles);
    const m = countMatches(formed, target);
    const bar = progressBar(m, target.length);
    const text = [
      "FlipStitch "+new Date().toLocaleDateString(),
      "Daily #"+dailyCount+(solved?" — Solved!":" — Unsolved"),
      "Moves: "+moves,
      bar,
      solved ? "Word: "+target.toUpperCase() : "First letter: "+target[0].toUpperCase(),
      location.href.split('#')[0]
    ].join("\n");
    navigator.clipboard.writeText(text).then(()=>{
      showToast("Result copied to clipboard");
    },()=>{
      showToast("Copy failed — select and copy manually", "bad");
    });
  });

  function progressBar(x, n){
    const full = "█", empty = "░";
    let s=""; for(let i=0;i<n;i++) s += i<x ? full : empty;
    return s;
  }

  // Keyboard shortcuts for accessibility
  document.addEventListener('keydown', (e)=>{
    if(isSolved()) return;
    if(selected===null) return;
    if(e.key==="ArrowLeft"){ e.preventDefault(); moveSelected('left');}
    if(e.key==="ArrowRight"){ e.preventDefault(); moveSelected('right');}
    if(e.key.toLowerCase()==="f"){ e.preventDefault(); flipSelected(); }
    if(e.key==="Enter"){ e.preventDefault(); if(isSolved()) finalizeWin(); else checkBtn.click(); }
  });

  // Initial render
  renderTiles();
  updateOut();

})();
</script>
</body>
</html>