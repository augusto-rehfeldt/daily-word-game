<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Daily Splice â€” Match prefixes and suffixes</title>
<style>
  :root{
    --bg: #fafafa;
    --fg: #1a1a1a;
    --muted: #6b7280;
    --card: #ffffff;
    --accent: #2563eb;
    --accent-2: #7c3aed;
    --border: #e5e7eb;
    --correct: #16a34a;
    --wrong: #dc2626;
    --btn: #ffffff;
    --btn-border: #d1d5db;
    --shadow: 0 6px 20px rgba(0,0,0,0.08);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg: #0f1115;
      --fg: #e5e7eb;
      --muted: #9ca3af;
      --card: #151923;
      --accent: #60a5fa;
      --accent-2: #a78bfa;
      --border: #263043;
      --btn: #1b2130;
      --btn-border: #2a344a;
      --shadow: 0 6px 20px rgba(0,0,0,0.4);
    }
  }

  *{ box-sizing: border-box; }
  html, body { height: 100%; }
  body{
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Cantarell, Ubuntu, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    background: radial-gradient(1200px 800px at 10% -10%, rgba(37,99,235,0.09), transparent 40%),
                radial-gradient(1000px 700px at 110% 10%, rgba(124,58,237,0.10), transparent 40%),
                var(--bg);
    color: var(--fg);
  }

  .wrap{
    max-width: 980px;
    margin: 0 auto;
    padding: 16px;
    min-height: 100svh;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  header{
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
  }
  .title{
    display: flex;
    align-items: baseline;
    gap: 10px;
  }
  h1{
    font-size: 1.4rem;
    margin: 0;
    letter-spacing: 0.4px;
  }
  .date{
    color: var(--muted);
    font-size: 0.95rem;
  }

  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent 40%), var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 14px;
    box-shadow: var(--shadow);
  }

  .rules{
    font-size: 0.98rem;
    line-height: 1.45;
    color: var(--fg);
  }
  .rules b{ color: var(--accent); }
  .rules .small{
    color: var(--muted);
    font-size: 0.9rem;
  }

  .board{
    display: grid;
    grid-template-columns: 1.1fr 0.05fr 1.1fr;
    gap: 10px;
    align-items: stretch;
  }
  .col{
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
  }
  .col h3{
    margin: 0 0 6px 0;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--muted);
  }
  .divider{
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--muted);
    font-weight: 600;
  }
  .pill{
    user-select: none;
    border: 2px solid var(--btn-border);
    background: var(--btn);
    color: var(--fg);
    border-radius: 12px;
    padding: 12px 14px;
    font-size: 1.15rem;
    text-align: center;
    cursor: pointer;
    transition: transform .06s ease, border-color .12s ease, background .12s ease, box-shadow .12s ease;
    min-height: 48px;
  }
  .pill:active{ transform: translateY(1px) scale(0.98); }
  .pill.selected{
    border-color: var(--accent);
    box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent) 30%, transparent);
  }
  .pill.alt.selected{
    border-color: var(--accent-2);
    box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent-2) 30%, transparent);
  }
  .pill.disabled{
    cursor: default;
    opacity: 0.55;
    background: linear-gradient(180deg, rgba(22,163,74,0.09), rgba(22,163,74,0.04)) ;
    border-color: color-mix(in oklab, var(--correct) 40%, var(--btn-border));
  }
  .pill.shake{
    animation: shake .25s linear 1;
  }
  @keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-4px); }
    50% { transform: translateX(4px); }
    75% { transform: translateX(-3px); }
    100% { transform: translateX(0); }
  }

  .clues{
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 14px;
  }
  .clue{
    border: 1px dashed var(--border);
    border-radius: 12px;
    padding: 10px 12px;
    font-size: 0.98rem;
    color: var(--fg);
    min-height: 46px;
    display: grid;
    grid-template-columns: auto 1fr;
    align-items: center;
    gap: 8px;
    background: linear-gradient(180deg, rgba(124,58,237,0.06), transparent 55%);
  }
  .clue .idx{
    width: 28px; height: 28px; border-radius: 50%;
    display: inline-flex; align-items: center; justify-content: center;
    background: color-mix(in oklab, var(--accent) 18%, var(--card));
    border: 1px solid var(--border);
    color: var(--muted);
    font-weight: 700; font-size: 0.9rem;
  }
  .clue.solved{
    border-style: solid;
    border-color: color-mix(in oklab, var(--correct) 40%, var(--border));
    background: linear-gradient(180deg, rgba(22,163,74,0.10), rgba(22,163,74,0.02));
  }
  .clue .word{
    font-weight: 700;
    color: var(--correct);
    margin-right: 6px;
  }
  .clue .txt{ color: var(--fg); }
  .progress{
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    flex-wrap: wrap;
    color: var(--muted);
    font-size: 0.95rem;
  }
  .progress .stats b{ color: var(--fg); }
  .btn-row{
    display: flex; gap: 8px; flex-wrap: wrap;
  }
  .btn{
    border-radius: 10px;
    padding: 10px 12px;
    border: 1px solid var(--border);
    background: var(--card);
    color: var(--fg);
    font-weight: 600;
    cursor: pointer;
    transition: background .12s ease, transform .06s ease, border-color .12s ease, box-shadow .12s ease;
  }
  .btn:active{ transform: translateY(1px) scale(0.98); }
  .btn.primary{
    background: linear-gradient(180deg, color-mix(in oklab, var(--accent) 24%, transparent), transparent 55%);
    border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
  }
  .btn.share{
    background: linear-gradient(180deg, color-mix(in oklab, var(--accent-2) 24%, transparent), transparent 55%);
    border-color: color-mix(in oklab, var(--accent-2) 45%, var(--border));
  }
  .banner{
    margin-top: 8px;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid color-mix(in oklab, var(--correct) 35%, var(--border));
    background: linear-gradient(180deg, rgba(22,163,74,0.12), rgba(22,163,74,0.02));
    color: var(--fg);
    display: none;
  }
  .banner.show{ display: block; }

  footer{
    margin-top: auto;
    padding: 10px 2px 14px;
    color: var(--muted);
    font-size: 0.9rem;
    display: flex; align-items: center; justify-content: space-between;
    gap: 10px; flex-wrap: wrap;
  }
  .legend{
    display: flex; gap: 10px; flex-wrap: wrap; align-items: center;
  }
  .legend .dot{
    width: 12px; height: 12px; border-radius: 50%;
  }
  .dot.pref{ background: var(--accent); }
  .dot.suf{ background: var(--accent-2); }
  .dot.sol{ background: var(--correct); }

  @media (max-width: 900px){
    .clues{ grid-template-columns: 1fr; }
  }
  @media (max-width: 740px){
    .board{
      grid-template-columns: 1fr;
    }
    .divider{ display: none; }
  }
  @media (max-height: 720px){
    .rules{ font-size: 0.95rem; }
    .pill{ min-height: 44px; }
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">
      <h1>Daily Splice</h1>
      <div class="date" id="date"></div>
    </div>
    <div class="btn-row">
      <button class="btn" id="how">How to play</button>
      <button class="btn" id="reset">Reset</button>
    </div>
  </header>

  <section class="card rules" id="rules">
    Combine one prefix from the left with one suffix from the right to form a real English word that matches a clue below.
    Each prefix and each suffix is used exactly once. Tap a prefix, then a suffix to submit a pair.
    Win by completing all six words.
    <div class="small" style="margin-top:6px">A fresh, deterministic puzzle appears each day. Progress is saved locally.</div>
  </section>

  <section class="card">
    <div class="board">
      <div class="col">
        <h3>Prefixes</h3>
        <div id="prefixes"></div>
      </div>
      <div class="divider">+</div>
      <div class="col">
        <h3>Suffixes</h3>
        <div id="suffixes"></div>
      </div>
    </div>
    <div style="height:10px"></div>
    <div class="clues" id="clueList"></div>
    <div class="progress" style="margin-top:10px">
      <div class="stats" id="stats">0/6 solved â€¢ 0 attempts</div>
      <div class="btn-row">
        <button class="btn primary" id="hint">Hint</button>
        <button class="btn share" id="share">Share</button>
      </div>
    </div>
    <div class="banner" id="winBanner"></div>
  </section>

  <footer>
    <div class="legend">
      <span class="dot pref" aria-hidden="true"></span> prefix
      <span class="dot suf" aria-hidden="true"></span> suffix
      <span class="dot sol" aria-hidden="true"></span> solved
    </div>
    <div>Made for today â€” no downloads, no ads.</div>
  </footer>
</div>

<script>
(function(){
  // Word pool: prefix + suffix -> word, with a short clue.
  // Each day's puzzle picks 6 with unique prefixes and suffixes.
  const POOL = [
    {p:"after",s:"noon",w:"afternoon",c:"midday hours"},
    {p:"ear",s:"mark",w:"earmark",c:"set aside for a purpose"},
    {p:"over",s:"lap",w:"overlap",c:"partially cover"},
    {p:"rain",s:"bow",w:"rainbow",c:"arch of colors"},
    {p:"under",s:"line",w:"underline",c:"emphasize with a mark"},
    {p:"time",s:"line",w:"timeline",c:"chronological sequence"},
    {p:"base",s:"line",w:"baseline",c:"starting reference"},
    {p:"back",s:"hand",w:"backhand",c:"reverse tennis stroke"},
    {p:"sun",s:"rise",w:"sunrise",c:"dawn"},
    {p:"moon",s:"light",w:"moonlight",c:"soft night glow"},
    {p:"star",s:"fish",w:"starfish",c:"spiny sea creature"},
    {p:"tooth",s:"brush",w:"toothbrush",c:"oral care tool"},
    {p:"rain",s:"coat",w:"raincoat",c:"waterproof jacket"},
    {p:"foot",s:"note",w:"footnote",c:"bottom-of-page remark"},
    {p:"over",s:"cast",w:"overcast",c:"cloudy sky"},
    {p:"side",s:"walk",w:"sidewalk",c:"pavement for pedestrians"},
    {p:"drum",s:"stick",w:"drumstick",c:"percussion beater"},
    {p:"lamp",s:"shade",w:"lampshade",c:"light-covering cone"},
    {p:"book",s:"shelf",w:"bookshelf",c:"place to store books"},
    {p:"fire",s:"place",w:"fireplace",c:"indoor hearth"},
    {p:"door",s:"knob",w:"doorknob",c:"rounded handle"},
    {p:"corn",s:"bread",w:"cornbread",c:"bread with maize"},
    {p:"some",s:"where",w:"somewhere",c:"in an unspecified place"},
    {p:"any",s:"thing",w:"anything",c:"whatever object"},
    {p:"every",s:"day",w:"everyday",c:"ordinary, routine"},
    {p:"walk",s:"way",w:"walkway",c:"path for walking"},
    {p:"hand",s:"shake",w:"handshake",c:"greeting grip"},
    {p:"snow",s:"ball",w:"snowball",c:"packed winter throw"},
    {p:"sand",s:"box",w:"sandbox",c:"play area with grains"},
    {p:"note",s:"book",w:"notebook",c:"blank pages to write on"},
    {p:"work",s:"shop",w:"workshop",c:"hands-on class"},
    {p:"news",s:"paper",w:"newspaper",c:"daily printed outlet"},
    {p:"sea",s:"shore",w:"seashore",c:"coastal edge"},
    {p:"back",s:"pack",w:"backpack",c:"bag worn on the back"},
    {p:"air",s:"port",w:"airport",c:"terminal for flights"},
    {p:"blue",s:"print",w:"blueprint",c:"detailed plan"},
    {p:"code",s:"name",w:"codename",c:"secret designation"},
    {p:"long",s:"hand",w:"longhand",c:"cursive script"},
    {p:"short",s:"cut",w:"shortcut",c:"faster route"},
    {p:"side",s:"note",w:"sidenote",c:"secondary remark"},
    {p:"day",s:"dream",w:"daydream",c:"pleasant fantasy while awake"},
    {p:"brain",s:"storm",w:"brainstorm",c:"idea-generating session"},
    {p:"moon",s:"walk",w:"moonwalk",c:"spacey backward dance"},
    {p:"out",s:"come",w:"outcome",c:"result"},
    {p:"fore",s:"cast",w:"forecast",c:"prediction"},
    {p:"war",s:"time",w:"wartime",c:"period of conflict"},
    {p:"table",s:"spoon",w:"tablespoon",c:"large kitchen spoon"},
    {p:"key",s:"board",w:"keyboard",c:"typing panel"},
    {p:"heart",s:"beat",w:"heartbeat",c:"pulse"},
    {p:"bed",s:"time",w:"bedtime",c:"hour for sleep"},
    {p:"birth",s:"place",w:"birthplace",c:"where someone was born"},
    {p:"wind",s:"shield",w:"windshield",c:"front car glass"},
    {p:"cow",s:"bell",w:"cowbell",c:"clanging bovine accessory"},
    {p:"side",s:"kick",w:"sidekick",c:"heroâ€™s partner"},
    {p:"rain",s:"drop",w:"raindrop",c:"single falling bead of water"},
    {p:"scare",s:"crow",w:"scarecrow",c:"field guardian"},
    {p:"wire",s:"less",w:"wireless",c:"without cables"},
    {p:"home",s:"work",w:"homework",c:"school assignment"},
    {p:"class",s:"room",w:"classroom",c:"teaching space"},
    {p:"wood",s:"work",w:"woodwork",c:"carpentry output"},
    {p:"ship",s:"wreck",w:"shipwreck",c:"sunken ruin"},
    {p:"butter",s:"fly",w:"butterfly",c:"colorful winged insect"},
    {p:"eye",s:"brow",w:"eyebrow",c:"arch of hair above an eye"},
    {p:"sun",s:"flower",w:"sunflower",c:"tall yellow plant"},
    {p:"cup",s:"cake",w:"cupcake",c:"small frosted treat"},
    {p:"hair",s:"cut",w:"haircut",c:"trim for tresses"},
    {p:"light",s:"house",w:"lighthouse",c:"beacon by the sea"},
    {p:"green",s:"house",w:"greenhouse",c:"glass plant shelter"},
    {p:"break",s:"fast",w:"breakfast",c:"morning meal"},
    {p:"over",s:"board",w:"overboard",c:"into the water"},
    {p:"under",s:"world",w:"underworld",c:"criminal realm"},
    {p:"auto",s:"pilot",w:"autopilot",c:"hands-off flight control"},
    {p:"water",s:"proof",w:"waterproof",c:"resistant to wetness"},
    {p:"super",s:"hero",w:"superhero",c:"cape-worthy savior"},
    {p:"after",s:"math",w:"aftermath",c:"consequences"},
    {p:"near",s:"by",w:"nearby",c:"close at hand"},
    {p:"news",s:"room",w:"newsroom",c:"journalistsâ€™ office"},
    {p:"foot",s:"ball",w:"football",c:"pitch sport with a goal"},
    {p:"hand",s:"bag",w:"handbag",c:"purse"},
    {p:"brain",s:"child",w:"brainchild",c:"invention"},
    {p:"cross",s:"walk",w:"crosswalk",c:"striped street crossing"},
    {p:"night",s:"mare",w:"nightmare",c:"frightening dream"},
    {p:"whole",s:"sale",w:"wholesale",c:"bulk trade"},
    {p:"common",s:"place",w:"commonplace",c:"ordinary"},
    {p:"bed",s:"rock",w:"bedrock",c:"solid foundation"},
    {p:"south",s:"west",w:"southwest",c:"lower-left compass point"},
    {p:"south",s:"east",w:"southeast",c:"lower-right compass point"},
    {p:"north",s:"west",w:"northwest",c:"upper-left compass point"},
    {p:"north",s:"east",w:"northeast",c:"upper-right compass point"},
    {p:"under",s:"take",w:"undertake",c:"accept a task"},
    {p:"over",s:"charge",w:"overcharge",c:"bill too much"},
    {p:"ship",s:"yard",w:"shipyard",c:"dockside works"},
    {p:"farm",s:"house",w:"farmhouse",c:"rural dwelling"},
    {p:"blood",s:"stream",w:"bloodstream",c:"circulating river inside you"},
    {p:"moon",s:"stone",w:"moonstone",c:"pale gem"},
    {p:"field",s:"work",w:"fieldwork",c:"on-site research"},
    {p:"counter",s:"point",w:"counterpoint",c:"contrasting argument"},
    {p:"over",s:"head",w:"overhead",c:"above your head"},
    {p:"horse",s:"shoe",w:"horseshoe",c:"U-shaped hoof fitting"},
    {p:"bare",s:"foot",w:"barefoot",c:"without shoes"},
    {p:"stair",s:"case",w:"staircase",c:"flight between floors"},
    {p:"wind",s:"farm",w:"windfarm",c:"turbine field"},
    {p:"work",s:"place",w:"workplace",c:"site of employment"},
    {p:"heart",s:"ache",w:"heartache",c:"deep sorrow"},
    {p:"screen",s:"shot",w:"screenshot",c:"captured display image"},
    {p:"sky",s:"line",w:"skyline",c:"cityâ€™s edge against the sky"},
    {p:"under",s:"skirt",w:"underskirt",c:"garment worn beneath a dress"},
    {p:"back",s:"ground",w:"background",c:"context or backdrop"},
    {p:"home",s:"town",w:"hometown",c:"place you grew up"},
    {p:"birth",s:"day",w:"birthday",c:"annual cake event"},
    {p:"day",s:"break",w:"daybreak",c:"first light"},
    {p:"class",s:"mate",w:"classmate",c:"fellow student"},
    {p:"bed",s:"sheet",w:"bedsheet",c:"top layer for a mattress"},
    {p:"rain",s:"storm",w:"rainstorm",c:"downpour with wind"},
    {p:"land",s:"mark",w:"landmark",c:"prominent feature or monument"},
    {p:"water",s:"fall",w:"waterfall",c:"river drop"},
    {p:"spoon",s:"ful",w:"spoonful",c:"amount a spoon holds"},
    {p:"under",s:"tone",w:"undertone",c:"subtle shade or meaning"},
    {p:"over",s:"time",w:"overtime",c:"extra working hours"},
    {p:"after",s:"taste",w:"aftertaste",c:"lingering flavor"},
    {p:"life",s:"time",w:"lifetime",c:"entire lifespan"},
    {p:"arm",s:"chair",w:"armchair",c:"padded seat with supports"},
    {p:"some",s:"one",w:"someone",c:"a single person"},
    {p:"any",s:"where",w:"anywhere",c:"in any place"},
    {p:"every",s:"thing",w:"everything",c:"all of it"},
    {p:"news",s:"stand",w:"newsstand",c:"kiosk for papers"},
    {p:"head",s:"band",w:"headband",c:"strip worn around the forehead"},
    {p:"book",s:"case",w:"bookcase",c:"furniture for volumes"},
    {p:"foot",s:"path",w:"footpath",c:"narrow track for walkers"},
    {p:"work",s:"bench",w:"workbench",c:"sturdy table for building"},
    {p:"play",s:"ground",w:"playground",c:"outdoor area for kids"},
    {p:"door",s:"step",w:"doorstep",c:"threshold"},
    {p:"sun",s:"burn",w:"sunburn",c:"reddening from UV"},
    {p:"heart",s:"burn",w:"heartburn",c:"acid reflux discomfort"},
    {p:"news",s:"flash",w:"newsflash",c:"brief urgent report"},
    {p:"under",s:"wear",w:"underwear",c:"garments under clothes"},
    {p:"over",s:"reach",w:"overreach",c:"exceed your limits"},
    {p:"moon",s:"beam",w:"moonbeam",c:"sliver of nocturnal light"},
    {p:"hand",s:"made",w:"handmade",c:"crafted by hand"},
    {p:"water",s:"line",w:"waterline",c:"level of the sea on a hull"},
    {p:"fire",s:"fly",w:"firefly",c:"glowing insect"},
    {p:"snow",s:"man",w:"snowman",c:"frosty figure"},
    {p:"wind",s:"mill",w:"windmill",c:"sail-turned grinder"},
    {p:"sail",s:"boat",w:"sailboat",c:"wind-powered vessel"},
    {p:"sea",s:"weed",w:"seaweed",c:"marine plant"},
    {p:"star",s:"light",w:"starlight",c:"glow from distant suns"},
    {p:"ear",s:"phone",w:"earphone",c:"small audio bud"},
    {p:"book",s:"worm",w:"bookworm",c:"avid reader"},
    {p:"night",s:"fall",w:"nightfall",c:"onset of evening"}
  ];

  // Deterministic RNG (mulberry32)
  function mulberry32(a) {
    return function() {
      let t = a += 0x6D2B79F5;
      t = Math.imul(t ^ (t >>> 15), t | 1);
      t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
      return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
    }
  }
  function hashSeed(str){
    let h = 2166136261 >>> 0;
    for (let i=0;i<str.length;i++){
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return h >>> 0;
  }
  function fyShuffle(arr, rnd){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(rnd()*(i+1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }
  function pickToday(seed){
    // Try to pick 6 with unique prefixes and suffixes
    for(let attempt=0; attempt<64; attempt++){
      const rnd = mulberry32(seed + attempt * 101);
      const idx = Array.from(POOL.keys());
      fyShuffle(idx, rnd);
      const chosen = [];
      const usedP = new Set(), usedS = new Set();
      for(const i of idx){
        const item = POOL[i];
        if (!usedP.has(item.p) && !usedS.has(item.s)){
          chosen.push({...item, id: i});
          usedP.add(item.p);
          usedS.add(item.s);
          if (chosen.length === 6) break;
        }
      }
      if (chosen.length === 6) return {chosen, rndSeed: seed + attempt * 101};
    }
    // Fallback: deterministic first 6 safe unique pairs
    const safe = [];
    const usedP = new Set(), usedS = new Set();
    for (let i=0;i<POOL.length && safe.length<6;i++){
      const it = POOL[i];
      if (!usedP.has(it.p) && !usedS.has(it.s)){
        safe.push({...it, id: i});
        usedP.add(it.p); usedS.add(it.s);
      }
    }
    return {chosen: safe, rndSeed: seed + 999};
  }

  // State
  const today = new Date();
  const localDateKey = [
    today.getFullYear(),
    String(today.getMonth()+1).padStart(2,'0'),
    String(today.getDate()).padStart(2,'0')
  ].join("-");
  const seed = hashSeed(localDateKey + "|splice:v1");
  const selection = pickToday(seed);
  const TODAY = selection.chosen;
  const RNG = mulberry32(selection.rndSeed ^ 0x9e3779b9);

  // Shuffle visible prefix and suffix lists independently
  const PREFS = fyShuffle(TODAY.map(x=>x.p), mulberry32(seed ^ 0xABCDEF01));
  const SUFS  = fyShuffle(TODAY.map(x=>x.s), mulberry32(seed ^ 0x13579BDF));

  // Map word to clue
  const WORD_TO_CLUE = new Map(TODAY.map(x=>[x.w, x.c]));
  const PAIRS = new Map(TODAY.map(x=>[x.p+"|"+x.s, x.w]));
  const WORD_BY_PREFIX = new Map(TODAY.map(x=>[x.p, x.w]));
  const WORD_BY_SUFFIX = new Map(TODAY.map(x=>[x.s, x.w]));
  const CLUES_ORDER = fyShuffle(TODAY.slice(), mulberry32(seed ^ 0xCAFEBABE)); // random clue order for display

  // DOM refs
  const elDate = document.getElementById('date');
  const elPrefixes = document.getElementById('prefixes');
  const elSuffixes = document.getElementById('suffixes');
  const elClues = document.getElementById('clueList');
  const elStats = document.getElementById('stats');
  const elRules = document.getElementById('rules');
  const btnHow = document.getElementById('how');
  const btnReset = document.getElementById('reset');
  const btnHint = document.getElementById('hint');
  const btnShare = document.getElementById('share');
  const winBanner = document.getElementById('winBanner');

  elDate.textContent = localDateKey;

  // Persistence
  const LSKEY = "splice_v1_" + localDateKey;
  const saved = JSON.parse(localStorage.getItem(LSKEY) || "{}");
  const state = {
    attempts: saved.attempts || 0,
    solved: new Set(saved.solved || []),
    hintUsed: saved.hintUsed || 0
  };

  // Build UI lists
  function makeBtn(text, cls){
    const b = document.createElement('button');
    b.type = 'button';
    b.className = 'pill ' + (cls || '');
    b.textContent = text;
    b.dataset.val = text;
    b.setAttribute('aria-label', text);
    b.style.width = '100%';
    return b;
  }
  function renderLists(){
    elPrefixes.innerHTML = '';
    elSuffixes.innerHTML = '';
    const usedPrefix = new Set(Array.from(state.solved).map(w => [...WORD_TO_CLUE.keys()].includes(w) ? TODAY.find(t=>t.w===w).p : null));
    const usedSuffix = new Set(Array.from(state.solved).map(w => [...WORD_TO_CLUE.keys()].includes(w) ? TODAY.find(t=>t.w===w).s : null));

    PREFS.forEach(p=>{
      const btn = makeBtn(p);
      btn.classList.add('pref');
      if (usedPrefix.has(p)) {
        btn.classList.add('disabled');
        btn.disabled = true;
      }
      elPrefixes.appendChild(btn);
    });
    SUFS.forEach(s=>{
      const btn = makeBtn(s, 'alt');
      if (usedSuffix.has(s)) {
        btn.classList.add('disabled');
        btn.disabled = true;
      }
      elSuffixes.appendChild(btn);
    });
  }
  function renderClues(){
    elClues.innerHTML = '';
    CLUES_ORDER.forEach((item, idx)=>{
      const li = document.createElement('div');
      li.className = 'clue';
      li.dataset.word = item.w;
      const n = document.createElement('div');
      n.className = 'idx';
      n.textContent = String.fromCharCode(65 + idx);
      const t = document.createElement('div');
      const solved = state.solved.has(item.w);
      t.innerHTML = (solved ? `<span class="word">${item.w}</span> â€” ` : '') + `<span class="txt">${item.c}</span>`;
      if (solved) li.classList.add('solved');
      li.appendChild(n); li.appendChild(t);
      elClues.appendChild(li);
    });
  }
  function updateStats(){
    const solvedCount = state.solved.size;
    elStats.innerHTML = `<b>${solvedCount}</b>/6 solved â€¢ <b>${state.attempts}</b> attempts${state.hintUsed ? ` â€¢ ${state.hintUsed} hint${state.hintUsed>1?'s':''}`:''}`;
  }
  function persist(){
    localStorage.setItem(LSKEY, JSON.stringify({
      attempts: state.attempts,
      solved: Array.from(state.solved),
      hintUsed: state.hintUsed
    }));
  }

  renderLists();
  renderClues();
  updateStats();

  // Selection and pairing
  let selectedP = null;
  let selectedS = null;

  function clearSelections(){
    selectedP = null; selectedS = null;
    elPrefixes.querySelectorAll('.pill').forEach(b=>b.classList.remove('selected'));
    elSuffixes.querySelectorAll('.pill').forEach(b=>b.classList.remove('selected'));
  }

  function markSolvedWord(word){
    state.solved.add(word);
    // Disable used prefix and suffix buttons
    const t = TODAY.find(x=>x.w===word);
    const pBtn = [...elPrefixes.querySelectorAll('.pill')].find(b=>b.dataset.val===t.p);
    const sBtn = [...elSuffixes.querySelectorAll('.pill')].find(b=>b.dataset.val===t.s);
    if (pBtn){ pBtn.classList.remove('selected'); pBtn.classList.add('disabled'); pBtn.disabled = true; }
    if (sBtn){ sBtn.classList.remove('selected'); sBtn.classList.add('disabled'); sBtn.disabled = true; }

    // Mark clue solved
    elClues.querySelectorAll('.clue').forEach(c=>{
      if (c.dataset.word === word){
        c.classList.add('solved');
        const txt = c.querySelector('.txt').textContent;
        c.querySelector('.idx').style.background = 'color-mix(in oklab, var(--correct) 35%, var(--card))';
        c.querySelector('.idx').style.color = 'var(--fg)';
        c.querySelector('div:nth-child(2)').innerHTML = `<span class="word">${word}</span> â€” <span class="txt">${txt}</span>`;
      }
    });
  }

  function tryPair(){
    const p = selectedP, s = selectedS;
    if (!p || !s) return;
    state.attempts++;
    const k = p + "|" + s;
    const formed = PAIRS.get(k);
    if (formed && !state.solved.has(formed)){
      // correct
      markSolvedWord(formed);
      // tiny confetti-like pulse feedback on clues panel
      const solvedCount = state.solved.size;
      elClues.style.transform = 'scale(1.01)';
      elClues.style.transition = 'transform .08s ease';
      setTimeout(()=>{ elClues.style.transform = 'scale(1)'; }, 90);
    } else {
      // wrong feedback
      const pb = [...elPrefixes.querySelectorAll('.pill')].find(b=>b.dataset.val===p);
      const sb = [...elSuffixes.querySelectorAll('.pill')].find(b=>b.dataset.val===s);
      [pb, sb].forEach(b=>{
        if (!b) return;
        b.classList.add('shake');
        b.style.borderColor = 'color-mix(in oklab, var(--wrong) 40%, var(--btn-border))';
        setTimeout(()=>{
          b.classList.remove('shake');
          b.style.borderColor = '';
        }, 220);
      });
    }
    persist();
    updateStats();
    clearSelections();
    checkWin();
  }

  function checkWin(){
    if (state.solved.size === 6){
      winBanner.classList.add('show');
      winBanner.textContent = `You solved all 6 in ${state.attempts} attempts${state.hintUsed ? ` with ${state.hintUsed} hint${state.hintUsed>1?'s':''}`:''}! New puzzle tomorrow.`;
    }
  }

  function attachHandlers(){
    elPrefixes.addEventListener('click', (e)=>{
      const btn = e.target.closest('.pill');
      if (!btn || btn.disabled) return;
      const val = btn.dataset.val;
      const already = btn.classList.contains('selected');
      elPrefixes.querySelectorAll('.pill').forEach(b=>b.classList.remove('selected'));
      if (already){
        selectedP = null;
      } else {
        selectedP = val;
        btn.classList.add('selected');
      }
      if (selectedP && selectedS) tryPair();
    });
    elSuffixes.addEventListener('click', (e)=>{
      const btn = e.target.closest('.pill.alt');
      if (!btn || btn.disabled) return;
      const val = btn.dataset.val;
      const already = btn.classList.contains('selected');
      elSuffixes.querySelectorAll('.pill.alt').forEach(b=>b.classList.remove('selected'));
      if (already){
        selectedS = null;
      } else {
        selectedS = val;
        btn.classList.add('selected');
      }
      if (selectedP && selectedS) tryPair();
    });
  }
  attachHandlers();

  // Apply saved solved pairs
  if (state.solved.size){
    Array.from(state.solved).forEach(w=>{
      if (WORD_TO_CLUE.has(w)) markSolvedWord(w);
    });
    updateStats();
  }
  checkWin();

  // Controls
  let rulesVisible = true;
  btnHow.addEventListener('click', ()=>{
    rulesVisible = !rulesVisible;
    elRules.style.display = rulesVisible ? 'block' : 'none';
    btnHow.textContent = rulesVisible ? 'Hide rules' : 'How to play';
  });
  btnHow.textContent = 'Hide rules';

  btnReset.addEventListener('click', ()=>{
    if (!confirm('Reset todayâ€™s puzzle progress?')){
      return;
    }
    localStorage.removeItem(LSKEY);
    state.attempts = 0;
    state.solved = new Set();
    state.hintUsed = 0;
    clearSelections();
    renderLists();
    renderClues();
    updateStats();
    winBanner.classList.remove('show');
  });

  btnHint.addEventListener('click', ()=>{
    if (state.solved.size === 6) return;
    // Pick a random unsolved clue, highlight either its prefix or suffix
    const unsolved = TODAY.filter(x=>!state.solved.has(x.w));
    if (!unsolved.length) return;
    const target = unsolved[Math.floor(RNG()*unsolved.length)];
    // 50/50 show prefix or suffix
    const showPrefix = RNG() < 0.5;
    if (showPrefix){
      const btn = [...elPrefixes.querySelectorAll('.pill')].find(b=>b.dataset.val===target.p);
      if (btn && !btn.disabled){
        btn.classList.add('selected');
        selectedP = target.p;
      }
    } else {
      const btn = [...elSuffixes.querySelectorAll('.pill')].find(b=>b.dataset.val===target.s);
      if (btn && !btn.disabled){
        btn.classList.add('selected');
        selectedS = target.s;
      }
    }
    state.hintUsed++;
    persist();
    updateStats();
  });

  btnShare.addEventListener('click', async ()=>{
    const solvedCount = state.solved.size;
    const tries = state.attempts;
    const title = `Daily Splice ${localDateKey}`;
    const status = solvedCount===6 ? 'Solved' : 'In progress';
    const grid = buildShareGrid();
    const text = `${title} â€” ${status}\n${solvedCount}/6 in ${tries} attempts${state.hintUsed?` (+${state.hintUsed} hint${state.hintUsed>1?'s':''})`:''}\n${grid}\nPlay: open todayâ€™s Daily Splice`;
    try{
      await navigator.clipboard.writeText(text);
      toast('Result copied to clipboard');
    }catch(e){
      alert(text);
    }
  });
  function buildShareGrid(){
    // Represent solved/unsolved prefixes/suffixes in 6 rows
    // Using emojis for compactness
    const rows = TODAY.map(x=>{
      const ok = state.solved.has(x.w) ? 'ðŸŸ©' : 'â¬œ';
      return ok;
    });
    return rows.join('');
  }
  function toast(msg){
    // Simple ephemeral banner
    winBanner.textContent = msg;
    winBanner.classList.add('show');
    setTimeout(()=>{
      if (state.solved.size !== 6){
        winBanner.classList.remove('show');
        winBanner.textContent = '';
      } else {
        winBanner.textContent = `You solved all 6 in ${state.attempts} attempts${state.hintUsed ? ` with ${state.hintUsed} hint${state.hintUsed>1?'s':''}`:''}! New puzzle tomorrow.`;
      }
    }, 1800);
  }

  // Accessibility: keyboard support (optional, basic)
  document.addEventListener('keydown', (e)=>{
    if (e.key === 'Escape'){
      clearSelections();
    }
  });

})();
</script>
</body>
</html>